<section class="central-acao">
  <header class="central-acao__cabecalho">
    <div>
      <h2>{{ titulo }}</h2>
      <p class="central-acao__saudacao" *ngIf="resposta?.usuario?.nome">
        Olá, {{ resposta?.usuario?.nome }}!
      </p>
      <p class="central-acao__saudacao" *ngIf="resposta?.usuario?.transportadoraNome">
        {{ resposta?.usuario?.transportadoraNome }}
      </p>
    </div>
    <button type="button" class="btn btn--terciario" (click)="carregarVisao()" [disabled]="carregando">
      {{ carregando ? 'Atualizando…' : 'Atualizar visão' }}
    </button>
  </header>

  <section class="central-acao__patio" *ngIf="resposta?.situacaoPatio as patio">
    <strong>Situação do pátio:</strong>
    <span>{{ patio.descricao || patio.status || 'Indisponível' }}</span>
    <small *ngIf="patio.verificadoEm">Verificado em {{ patio.verificadoEm | date: 'dd/MM/yyyy HH:mm' }}</small>
  </section>

  <p class="central-acao__mensagem central-acao__mensagem--erro" *ngIf="erroCarregamento">{{ erroCarregamento }}</p>
  <p class="central-acao__mensagem central-acao__mensagem--sucesso" *ngIf="mensagemSucesso">{{ mensagemSucesso }}</p>
  <p class="central-acao__mensagem" *ngIf="carregando">Carregando visão consolidada do seu agendamento…</p>

  <section *ngIf="!carregando && resposta?.agendamentos?.length" class="central-acao__cards">
    <article
      *ngFor="let card of resposta?.agendamentos; trackBy: trackPorId"
      class="central-acao__card"
      aria-label="Card de ação do agendamento"
    >
      <header class="card-acao__cabecalho">
        <div class="card-acao__cabecalho-linha">
          <span class="card-acao__codigo">Agendamento {{ card.codigo }}</span>
          <span
            class="card-acao__status"
            [ngClass]="{
              'card-acao__status--ativo': card.acaoPrincipal?.habilitada,
              'card-acao__status--inativo': !card.acaoPrincipal?.habilitada
            }"
          >
            {{ card.statusDescricao || card.status }}
          </span>
        </div>
        <p class="card-acao__janela">{{ formatarJanela(card) }}</p>
      </header>

      <dl class="card-acao__informacoes">
        <div>
          <dt>Motorista</dt>
          <dd>{{ card.motoristaNome || 'Não informado' }}</dd>
        </div>
        <div>
          <dt>Transportadora</dt>
          <dd>{{ card.transportadoraNome || 'Não informado' }}</dd>
        </div>
        <div>
          <dt>Veículo</dt>
          <dd>{{ card.placaVeiculo || '—' }}</dd>
        </div>
        <div>
          <dt>Chegada prevista</dt>
          <dd>{{ formatarHorario(card.horarioPrevistoChegada) }}</dd>
        </div>
      </dl>

      <section class="card-acao__documentos" *ngIf="card.documentosPendentes?.length">
        <h4>Documentos pendentes</h4>
        <ul>
          <li *ngFor="let documento of card.documentosPendentes">
            <span>{{ documento.nomeArquivo }}</span>
            <small>{{ documento.mensagem || 'Aguardando validação automática' }}</small>
          </li>
        </ul>
      </section>

      <p class="card-acao__orientacao" *ngIf="card.mensagemOrientacao">{{ card.mensagemOrientacao }}</p>

      <button
        type="button"
        class="btn btn--primario card-acao__botao"
        (click)="executarAcao(card)"
        [disabled]="!card.acaoPrincipal?.habilitada || acaoEmExecucao === card.agendamentoId"
      >
        <span *ngIf="acaoEmExecucao === card.agendamentoId" class="card-acao__spinner" aria-hidden="true"></span>
        {{ card.acaoPrincipal?.titulo || 'Sem ações disponíveis' }}
      </button>
      <p class="card-acao__descricao" *ngIf="card.acaoPrincipal?.descricao">{{ card.acaoPrincipal?.descricao }}</p>
    </article>
  </section>

  <div class="central-acao__vazio" *ngIf="!carregando && resposta && (!resposta.agendamentos || !resposta.agendamentos.length)">
    Nenhuma ação pendente no momento. Revise sua documentação e acompanhe as notificações.
  </div>
</section>
