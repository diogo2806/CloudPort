<section class="detalhe-visita-trem">
  <header>
    <h1>Detalhes da Visita do Trem</h1>
    <button type="button" class="botao-voltar" (click)="voltarParaLista()">Voltar para a lista</button>
    <button type="button"
            class="botao-trabalho"
            *ngIf="visita?.statusVisita === 'CHEGOU'"
            (click)="irParaListaTrabalho()">
      Abrir lista de trabalho
    </button>
  </header>

  <div *ngIf="estaCarregando" class="estado-informativo">Carregando informações do trem...</div>

  <div *ngIf="!estaCarregando && erroCarregamento" class="estado-erro">
    {{ textoSeguro(erroCarregamento) }}
  </div>

  <article *ngIf="!estaCarregando && !erroCarregamento && visita" class="cartao-detalhe">
    <dl>
      <div>
        <dt>Trem</dt>
        <dd>{{ textoSeguro(visita.identificadorTrem) }}</dd>
      </div>
      <div>
        <dt>Operadora Ferroviária</dt>
        <dd>{{ textoSeguro(visita.operadoraFerroviaria) }}</dd>
      </div>
      <div>
        <dt>Previsão de Chegada (ETA)</dt>
        <dd>{{ visita.horaChegadaPrevista | date:'dd/MM/yyyy HH:mm' }}</dd>
      </div>
      <div>
        <dt>Previsão de Partida (ETD)</dt>
        <dd>{{ visita.horaPartidaPrevista | date:'dd/MM/yyyy HH:mm' }}</dd>
      </div>
      <div>
        <dt>Status Atual</dt>
        <dd>{{ textoSeguro(visita.statusVisita) }}</dd>
      </div>
    </dl>
    <p class="observacao">Essas informações são atualizadas diretamente pelo sistema operacional da ferrovia.</p>
  </article>

  <section *ngIf="!estaCarregando && !erroCarregamento && visita" class="painel-operacoes">
    <h2>Planejamento de Contêineres</h2>
    <nav class="abas-operacoes" aria-label="Seleção de operações">
      <button type="button"
              [class.ativa]="abaAtiva === 'DESCARGA'"
              (click)="selecionarAba('DESCARGA')">
        Para Descarregar ({{ obterItensAba('DESCARGA').length }})
      </button>
      <button type="button"
              [class.ativa]="abaAtiva === 'CARGA'"
              (click)="selecionarAba('CARGA')">
        Para Carregar ({{ obterItensAba('CARGA').length }})
      </button>
    </nav>

    <div *ngIf="mensagemOperacao" class="estado-sucesso">{{ textoSeguro(mensagemOperacao) }}</div>
    <div *ngIf="erroOperacao" class="estado-erro">{{ textoSeguro(erroOperacao) }}</div>

    <section class="lista-operacoes" *ngIf="obterItensAba(abaAtiva).length > 0; else semItens">
      <article class="linha-operacao" *ngFor="let item of obterItensAba(abaAtiva)">
        <div class="informacoes-conteiner">
          <span class="identificador">Contêiner: {{ textoSeguro(item.codigoConteiner) }}</span>
          <span class="status" [class.concluido]="estaConcluido(item.statusOperacao)">
            {{ textoSeguro(descricaoStatus(item.statusOperacao)) }}
          </span>
        </div>
        <button type="button"
                class="botao-status"
                [disabled]="estaConcluido(item.statusOperacao) || operacaoEmAndamento"
                (click)="marcarComoConcluido(abaAtiva, item.codigoConteiner)">
          Marcar como concluído
        </button>
      </article>
    </section>

    <ng-template #semItens>
      <p class="estado-informativo">Nenhum contêiner planejado para esta operação.</p>
    </ng-template>
  </section>
</section>
