<section class="detalhe-visita-trem">
  <header>
    <h1>Detalhes da Visita do Trem</h1>
    <button type="button" class="botao-voltar" (click)="voltarParaLista()">Voltar para a lista</button>
    <button type="button"
            class="botao-trabalho"
            *ngIf="visita?.statusVisita === 'CHEGOU'"
            (click)="irParaListaTrabalho()">
      Abrir lista de trabalho
    </button>
  </header>

  <div *ngIf="estaCarregando" class="estado-informativo">Carregando informações do trem...</div>

  <div *ngIf="!estaCarregando && erroCarregamento" class="estado-erro">
    {{ textoSeguro(erroCarregamento) }}
  </div>

  <article *ngIf="!estaCarregando && !erroCarregamento && visita" class="cartao-detalhe">
    <dl>
      <div>
        <dt>Trem</dt>
        <dd>{{ textoSeguro(visita.identificadorTrem) }}</dd>
      </div>
      <div>
        <dt>Operadora Ferroviária</dt>
        <dd>{{ textoSeguro(visita.operadoraFerroviaria) }}</dd>
      </div>
      <div>
        <dt>Previsão de Chegada (ETA)</dt>
        <dd>{{ visita.horaChegadaPrevista | date:'dd/MM/yyyy HH:mm' }}</dd>
      </div>
      <div>
        <dt>Previsão de Partida (ETD)</dt>
        <dd>{{ visita.horaPartidaPrevista | date:'dd/MM/yyyy HH:mm' }}</dd>
      </div>
      <div>
        <dt>Status Atual</dt>
        <dd>{{ textoSeguro(visita.statusVisita) }}</dd>
      </div>
    </dl>
    <p class="observacao">Essas informações são atualizadas diretamente pelo sistema operacional da ferrovia.</p>
  </article>

  <section *ngIf="!estaCarregando && !erroCarregamento && visita" class="painel-operacoes">
    <h2>Planejamento de Contêineres por Vagão</h2>

    <div *ngIf="mensagemOperacao" class="estado-sucesso">{{ textoSeguro(mensagemOperacao) }}</div>
    <div *ngIf="erroOperacao" class="estado-erro">{{ textoSeguro(erroOperacao) }}</div>

    <div *ngIf="vagoesAgrupados.length === 0" class="estado-informativo">
      Nenhum vagão cadastrado para esta visita.
    </div>

    <ul class="arvore-vagoes" *ngIf="vagoesAgrupados.length > 0">
      <li *ngFor="let vagao of vagoesAgrupados" class="nodo-vagao">
        <div class="cabecalho-vagao">
          <span class="titulo-vagao">Vagão {{ textoSeguro(vagao.identificadorVagao) }}</span>
          <span class="posicao-vagao">Posição {{ vagao.posicaoNoTrem }}</span>
          <span class="tipo-vagao" *ngIf="vagao.tipoVagao">Tipo {{ textoSeguro(vagao.tipoVagao) }}</span>
        </div>
        <ul class="lista-conteineres" *ngIf="vagao.conteineres.length > 0">
          <li *ngFor="let conteiner of vagao.conteineres" class="nodo-conteiner">
            <div class="linha-conteiner">
              <span class="identificador">Contêiner {{ textoSeguro(conteiner.codigoConteiner) }}</span>
              <span class="tipo-movimentacao">{{ descricaoTipo(conteiner.tipoMovimentacao) }}</span>
              <span class="status" [class.concluido]="estaConcluido(conteiner.statusOperacao)">
                {{ descricaoStatus(conteiner.statusOperacao) }}
              </span>
              <button type="button"
                      class="botao-status"
                      [disabled]="estaConcluido(conteiner.statusOperacao) || operacaoEmAndamento"
                      (click)="marcarComoConcluido(conteiner)">
                Marcar como concluído
              </button>
            </div>
          </li>
        </ul>
        <p class="estado-informativo" *ngIf="vagao.conteineres.length === 0">
          Nenhum contêiner associado a este vagão.
        </p>
      </li>
    </ul>

    <section *ngIf="conteineresNaoAlocados.length > 0" class="secao-nao-alocados">
      <h3>Contêineres sem vagão associado</h3>
      <ul class="lista-conteineres">
        <li *ngFor="let conteiner of conteineresNaoAlocados" class="nodo-conteiner">
          <div class="linha-conteiner">
            <span class="identificador">Contêiner {{ textoSeguro(conteiner.codigoConteiner) }}</span>
            <span class="tipo-movimentacao">{{ descricaoTipo(conteiner.tipoMovimentacao) }}</span>
            <span class="status" [class.concluido]="estaConcluido(conteiner.statusOperacao)">
              {{ descricaoStatus(conteiner.statusOperacao) }}
            </span>
            <button type="button"
                    class="botao-status"
                    [disabled]="estaConcluido(conteiner.statusOperacao) || operacaoEmAndamento"
                    (click)="marcarComoConcluido(conteiner)">
              Marcar como concluído
            </button>
          </div>
        </li>
      </ul>
    </section>
  </section>
</section>
